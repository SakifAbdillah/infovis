<html>
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
	*{margin: 0px; padding: 0px}
	#map-canvas{width: 100%; height: 100%; display: block;}
	.panel{
		width: 300px;
		position: absolute;
		right: 10px;
		top: 10px;
		z-index: 9999;
		background-color: #fff;
		padding: 20px;
	}
	</style>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/css/materialize.min.css">
</head>
<body>
	<div class="panel">
			<h6>Heatmap Selector</h6>
			<p>
				<input type="radio" value="security" class="selection" name="selection" id="radio1" checked/>
				<label for="radio1">Safety</label>
			</p>
			<p>
				<input type="radio" value="emptyOffice" class="selection" name="selection" id="radio2"/>
				<label for="radio2">Empty Offices</label>
			</p>
        <p>
            <input type="radio" value="economicActivity" class="selection" name="selection" id="radio3"/>
            <label for="radio3">Economic Activity</label>
        </p>
		</div>
	</div>
	<div id="map-canvas"></div>
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANln09l2wflbNzL5kXlOkb4cuURGYMlvs"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/js/materialize.min.js"></script>
	<script type="text/javascript">
		
		window.onload = function(){
            var MY_MAPTYPE_ID = 'styled';
            var featureOpts = [
                {
                    "featureType": "administrative",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "landscape.natural",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "road",
                    "elementType": "geometry",
                    "stylers": [
                        { "color": "#c2c5c2" }
                    ]
                },{
                    "featureType": "poi",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "transit",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "road",
                    "elementType": "labels",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "water",
                    "elementType": "labels",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                },{
                    "featureType": "water",
                    "stylers": [
                        { "color": "#a7a7a7" }
                    ]
                }
            ];
            var mapOptions = {
                zoom: 12,
                center: new google.maps.LatLng(52.376078, 4.894151),
                mapTypeId: MY_MAPTYPE_ID
            };
			var styledMapOptions = {
				name: 'Custom Style'
			};

			var customMapType = new google.maps.StyledMapType(featureOpts, styledMapOptions);
			
			var map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);

			map.mapTypes.set(MY_MAPTYPE_ID, customMapType);

			map.data.loadGeoJson('amsterdamRegion.geojson');
			map.data.setStyle({
				strokeWeight : 0.5,
				fillOpacity: 1
			});
			map.data.addListener("mouseover", function(event){
				console.log(event.feature.k.sdbc);
			});
			var areasArray = [];
			$(function(){
				$.getJSON('areadata.json',function(data) {
					console.log(data);
	                //console.log('success');
	                var minEmptySpace = 0, maxEmptySpace = 0;
                    var minSecurity = 0, maxSecurity = 0;
                    var minEconomicActivity = 0, maxEconomicActivity = 0;
	                $.each(data.areas, function (i, area) {

	                    areasArray[areasArray.length] = [area.areaCode, area.security, area.emptySpace, area.economicActivity];

	                    var emptyOfficeHeight = d3.scale.linear().domain([minEmptySpace, maxEmptySpace]).range([0, 100]);

	                	if(area.emptySpace < minEmptySpace)
	                		minEmptySpace = area.emptySpace;
	                	else if(area.emptySpace > maxEmptySpace)
	                		maxEmptySpace = area.emptySpace;
                        if(area.security < minSecurity)
                            minSecurity = area.security;
                        else if(area.security > maxSecurity)
                            maxSecurity = area.security;
                        if(area.economicActivity < minEconomicActivity){
                            minEconomicActivity = area.economicActivity;
                            console.log(area.economicActivity);}
                        else if(area.economicActivity > maxEconomicActivity)
                            maxEconomicActivity = area.economicActivity;

	                	var image = {
							url: 'assets/tower.png',
							// This marker is 20 pixels wide by 32 pixels tall.
							size: new google.maps.Size(10, emptyOfficeHeight(area.emptySpace)),
							// The origin for this image is 0,0.
							origin: new google.maps.Point(0,0),
							// The anchor for this image is the base of the flagpole at 0,32.
							anchor: new google.maps.Point(10, emptyOfficeHeight(area.emptySpace))
						};
	                	if(area.hasOwnProperty('centerLatLng')){
		                	var marker = new google.maps.Marker({
								position: new google.maps.LatLng(area.centerLatLng.x, area.centerLatLng.y),
								icon: image,
								map: map,
								title:"Hello World!"
							});
	                	}
	                });

                    var economicActivityScale = d3.scale.linear().domain([minEconomicActivity, maxEconomicActivity]).range(["white", "green","yellow", "orange", "red","black"]);
	                var securityScale = d3.scale.linear().domain([minSecurity, maxSecurity]).range(["#feb24c", "#fd8d3c", "#fc4e2a", "#e31a1c", "#bd0026", "#800026"]);
                    var emptySpaceScale = d3.scale.linear().domain([minEmptySpace, maxEmptySpace]).range(["#feb24c", "#fd8d3c", "#fc4e2a", "#e31a1c", "#bd0026", "#800026"]);

                    var scales = [economicActivityScale, securityScale, emptySpaceScale];

	                $.each(data.areas, function (i, area) {
	                	console.log(area);

	                });


                    map.data.setStyle(function(feature) {
                        var parameter=1;
                        var thisAreaCode = feature.getProperty('sdbc');
                        var parameterValue;
                        for(var i = 0; i<areasArray.length; i++){
                            if(areasArray[i][0] == thisAreaCode){
                                parameterValue = parseInt(areasArray[i][parameter]);
                                console.log(i + " " + parameterValue);
                                break;
                            }
                        }
                        var scale = scales[parameter-1];
                        var color = scale(parameterValue);
                        return {
                            fillColor: color,
                            fillOpacity: 0.7
                        };
                        return {
                            fillColor: color
                        };
                    });

					$('.selection').change(function(e){
                        var parameter = 1;
						if($(this).val() == "security") {
                            parameter = 1;
                        }else if($(this).val() == "economicActivity"){
                            parameter = 3;
                        }else{
                            parameter=2;
                        }

                        map.data.setStyle(function(feature) {
							var thisAreaCode = feature.getProperty('sdbc');
							var parameterValue;
								for(var i = 0; i<areasArray.length; i++){
								    if(areasArray[i][0] == thisAreaCode){
								        parameterValue = parseInt(areasArray[i][parameter]);
								        console.log(i + " " + parameterValue);
								        break;
								    }
								}
                            var scale = scales[parameter-1];
                            var color = scale(parameterValue);
                            return {
                                fillColor: color,
                                fillOpacity: 0.7
                            };
								return {
									fillColor: color
								};
							});
					})
	    		}).error(function(){
	        			console.log('error');
	    		});	
    		});
		}

	</script>
</body>
</html>